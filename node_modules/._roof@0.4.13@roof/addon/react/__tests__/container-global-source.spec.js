//require('jasmine-pit').install(window)
jest.autoMockOff()
jest.dontMock('es6-promise');
require('es6-promise').polyfill();

describe('react addon container test', function(){

  it('retrieve data from Roof', function(  ){
    var React = require('react')
    var TestUtils = require('react-addons-test-utils');
    var ReactDom = require('react-dom');
    var Roof = require('roof')
    require('../container')
    var syncUsersFactory = require('./common/data/users.js')
    var UsersRootContainer = require('./common/component/UsersRootContainer.factory.jsx')(
      {users : syncUsersFactory}
    )

    var rootContainer = TestUtils.renderIntoDocument(<UsersRootContainer instanceName='inst1'/>);
    var users = syncUsersFactory()

    //data can be retrieved from Roof
    var usersFromGlobal =Roof.Sources.inst1.get('users')
    expect( usersFromGlobal.length ).toEqual( users.length );

    //should make the view change
    usersFromGlobal.insert({name:'Ins'})
    var usersDom= TestUtils.scryRenderedDOMComponentsWithClass(rootContainer, 'user');
    expect( usersFromGlobal.length ).toEqual( users.length +1);
    expect( usersDom.length ).toEqual( users.length +1);
  })

})